{"version":3,"file":"ListingItem.js","sourceRoot":"","sources":["../../../src/api/models/ListingItem.ts"],"names":[],"mappings":";AAAA,yDAAyD;AACzD,mEAAmE;AACnE,iFAAiF;;;AAEjF,oDAAkD;AAElD,uDAAoD;AACpD,6DAA0D;AAC1D,iEAA8D;AAC9D,2DAAwD;AAExD,iDAA8C;AAC9C,+DAA4D;AAC5D,+BAA4B;AAC5B,+CAA4C;AAC5C,qCAAkC;AAClC,yDAAsD;AACtD,mDAAgD;AAChD,yCAAsC;AACtC,8CAAyD;AAEzD,iBAAyB,SAAQ,oBAAS,CAAC,KAAkB;IA2ClD,MAAM,CAAO,SAAS,CAAC,KAAa,EAAE,cAAuB,IAAI;;YACpE,EAAE,CAAC,CAAC,WAAW,CAAC,CAAC,CAAC;gBACd,MAAM,CAAC,MAAM,WAAW,CAAC,KAAK,CAAc,EAAE,EAAE,EAAE,KAAK,EAAE,CAAC,CAAC,KAAK,CAAC;oBAC7D,WAAW,EAAE,IAAI,CAAC,SAAS;iBAC9B,CAAC,CAAC;YACP,CAAC;YAAC,IAAI,CAAC,CAAC;gBACJ,MAAM,CAAC,MAAM,WAAW,CAAC,KAAK,CAAc,EAAE,EAAE,EAAE,KAAK,EAAE,CAAC,CAAC,KAAK,EAAE,CAAC;YACvE,CAAC;QACL,CAAC;KAAA;IAEM,MAAM,CAAO,WAAW,CAAC,KAAa,EAAE,cAAuB,IAAI;;YACtE,EAAE,CAAC,CAAC,WAAW,CAAC,CAAC,CAAC;gBACd,MAAM,CAAC,MAAM,WAAW,CAAC,KAAK,CAAc,EAAE,IAAI,EAAE,KAAK,EAAE,CAAC,CAAC,KAAK,CAAC;oBAC/D,WAAW,EAAE,IAAI,CAAC,SAAS;iBAC9B,CAAC,CAAC;YACP,CAAC;YAAC,IAAI,CAAC,CAAC;gBACJ,MAAM,CAAC,MAAM,WAAW,CAAC,KAAK,CAAc,EAAE,IAAI,EAAE,KAAK,EAAE,CAAC,CAAC,KAAK,EAAE,CAAC;YACzE,CAAC;QACL,CAAC;KAAA;IAEM,MAAM,CAAO,eAAe,CAAC,UAAkB,EAAE,cAAuB,IAAI;;YAE/E,MAAM,iBAAiB,GAAG,WAAW,CAAC,KAAK,EAAsB;iBAC5D,KAAK,CAAC,EAAE;gBACL,EAAE,CAAC,SAAS,CAAC,mBAAmB,EAAE,kBAAkB,EAAE,mCAAmC,CAAC,CAAC;gBAC3F,EAAE,CAAC,KAAK,CAAC,oCAAoC,EAAE,GAAG,EAAE,UAAU,CAAC,CAAC;gBAChE,uBAAuB;gBACvB,EAAE,CAAC,QAAQ,CAAC,YAAY,EAAE,GAAG,EAAE,IAAI,CAAC,GAAG,EAAE,CAAC,CAAC;gBAC3C,EAAE,CAAC,QAAQ,CAAC,oCAAoC,EAAE,GAAG,EAAE,CAAC,CAAC,CAAC;YAC9D,CAAC,CAAC;iBACD,OAAO,CAAC,yBAAyB,EAAE,KAAK,CAAC,CAAC;YAE/C,EAAE,CAAC,CAAC,WAAW,CAAC,CAAC,CAAC;gBACd,MAAM,CAAC,MAAM,iBAAiB,CAAC,QAAQ,CAAC;oBACpC,WAAW,EAAE,IAAI,CAAC,SAAS;iBAC9B,CAAC,CAAC;YACP,CAAC;YAAC,IAAI,CAAC,CAAC;gBACJ,MAAM,CAAC,MAAM,iBAAiB,CAAC,QAAQ,EAAE,CAAC;YAC9C,CAAC;QACL,CAAC;KAAA;IAEM,MAAM,CAAO,YAAY;;YAC5B,MAAM,iBAAiB,GAAG,WAAW,CAAC,KAAK,EAAsB;iBAC5D,KAAK,CAAC,EAAE;gBACL,EAAE,CAAC,KAAK,CAAC,YAAY,EAAE,IAAI,EAAE,IAAI,CAAC,GAAG,EAAE,CAAC,CAAC;gBACzC,EAAE,CAAC,OAAO,CAAC,kBAAkB,CAAC,CAAC;YACnC,CAAC,CAAC,CAAC;YACP,MAAM,CAAC,MAAM,iBAAiB,CAAC,QAAQ,EAAE,CAAC;QAC9C,CAAC;KAAA;IAEM,MAAM,CAAO,QAAQ,CAAC,OAAgC,EAAE,cAAuB,KAAK;;YAEvF,MAAM,iBAAiB,GAAG,WAAW,CAAC,KAAK,EAAsB;iBAC5D,KAAK,CAAC,EAAE;gBACL,uBAAuB;gBACvB,EAAE,CAAC,KAAK,CAAC,YAAY,EAAE,GAAG,EAAE,IAAI,CAAC,GAAG,EAAE,CAAC,CAAC;gBAExC,qBAAqB;gBACrB,EAAE,CAAC,CAAC,OAAO,CAAC,QAAQ,IAAI,OAAO,OAAO,CAAC,QAAQ,KAAK,QAAQ,IAAI,OAAO,CAAC,QAAQ,KAAK,GAAG,CAAC,CAAC,CAAC;oBACvF,EAAE,CAAC,SAAS,CAAC,wBAAwB,EAAE,2BAA2B,EAAE,wCAAwC,CAAC,CAAC;oBAC9G,EAAE,CAAC,KAAK,CAAC,6BAA6B,EAAE,GAAG,EAAE,OAAO,CAAC,QAAQ,CAAC,CAAC;oBAE/D,WAAW,CAAC,GAAG,CAAC,KAAK,CAAC,yBAAyB,EAAE,OAAO,CAAC,QAAQ,CAAC,CAAC;gBACvE,CAAC;gBAED,kBAAkB;gBAClB,IAAI,UAAU,GAAG,KAAK,CAAC;gBACvB,EAAE,CAAC,CAAC,OAAO,CAAC,KAAK,IAAI,OAAO,OAAO,CAAC,KAAK,KAAK,QAAQ,IAAI,OAAO,CAAC,KAAK,KAAK,GAAG,CAAC,CAAC,CAAC;oBAC9E,EAAE,CAAC,CAAC,CAAC,UAAU,CAAC,CAAC,CAAC;wBACd,EAAE,CAAC,SAAS,CAAC,MAAM,EAAE,sBAAsB,EAAE,kBAAkB,CAAC,CAAC;wBACjE,UAAU,GAAG,IAAI,CAAC;oBACtB,CAAC;oBACD,EAAE,CAAC,KAAK,CAAC,aAAa,EAAE,GAAG,EAAE,OAAO,CAAC,KAAK,CAAC,CAAC;oBAC5C,WAAW,CAAC,GAAG,CAAC,KAAK,CAAC,sBAAsB,EAAE,OAAO,CAAC,KAAK,CAAC,CAAC;gBACjE,CAAC;gBAED,mBAAmB;gBACnB,EAAE,CAAC,CAAC,OAAO,CAAC,MAAM,IAAI,OAAO,OAAO,CAAC,MAAM,KAAK,QAAQ,IAAI,OAAO,CAAC,MAAM,KAAK,GAAG,CAAC,CAAC,CAAC;oBACjF,EAAE,CAAC,KAAK,CAAC,sBAAsB,EAAE,GAAG,EAAE,OAAO,CAAC,MAAM,CAAC,CAAC;oBACtD,WAAW,CAAC,GAAG,CAAC,KAAK,CAAC,uBAAuB,EAAE,OAAO,CAAC,MAAM,CAAC,CAAC;gBACnE,CAAC;gBAED,EAAE,CAAC,SAAS,CAAC,mBAAmB,EAAE,mCAAmC,EAAE,kBAAkB,CAAC,CAAC;gBAE3F,EAAE,CAAC,CAAC,OAAO,CAAC,QAAQ,IAAI,OAAO,OAAO,CAAC,QAAQ,KAAK,QAAQ,CAAC,CAAC,CAAC;oBAC3D,EAAE,CAAC,SAAS,CAAC,iBAAiB,EAAE,oBAAoB,EAAE,oCAAoC,CAAC,CAAC;oBAC5F,EAAE,CAAC,KAAK,CAAC,oBAAoB,EAAE,GAAG,EAAE,OAAO,CAAC,QAAQ,CAAC,CAAC;oBACtD,WAAW,CAAC,GAAG,CAAC,KAAK,CAAC,4BAA4B,EAAE,OAAO,CAAC,QAAQ,CAAC,CAAC;gBAC1E,CAAC;gBAAC,IAAI,CAAC,EAAE,CAAC,CAAC,OAAO,CAAC,QAAQ,IAAI,OAAO,OAAO,CAAC,QAAQ,KAAK,QAAQ,CAAC,CAAC,CAAC;oBAClE,EAAE,CAAC,SAAS,CAAC,iBAAiB,EAAE,oBAAoB,EAAE,oCAAoC,CAAC,CAAC;oBAC5F,EAAE,CAAC,KAAK,CAAC,qBAAqB,EAAE,GAAG,EAAE,OAAO,CAAC,QAAQ,CAAC,CAAC;oBACvD,WAAW,CAAC,GAAG,CAAC,KAAK,CAAC,6BAA6B,EAAE,OAAO,CAAC,QAAQ,CAAC,CAAC;gBAC3E,CAAC;gBAED,oBAAoB;gBACpB,EAAE,CAAC,CAAC,OAAO,OAAO,CAAC,SAAS,KAAK,QAAQ,CAAC,CAAC,CAAC;oBACxC,EAAE,CAAC,SAAS,CAAC,wBAAwB,EAAE,2BAA2B,EAAE,wCAAwC,CAAC,CAAC;oBAC9G,EAAE,CAAC,KAAK,CAAC,mCAAmC,EAAE,GAAG,EAAE,OAAO,CAAC,SAAS,CAAC,CAAC;oBACtE,WAAW,CAAC,GAAG,CAAC,KAAK,CAAC,0BAA0B,EAAE,OAAO,CAAC,SAAS,CAAC,CAAC;gBAEzE,CAAC;gBAAC,IAAI,CAAC,EAAE,CAAC,CAAC,OAAO,CAAC,SAAS,KAAK,KAAK,CAAC,CAAC,CAAC;oBACrC,EAAE,CAAC,SAAS,CAAC,wBAAwB,EAAE,2BAA2B,EAAE,wCAAwC,CAAC,CAAC;gBAClH,CAAC;gBAED,uBAAuB;gBACvB,EAAE,CAAC,CAAC,OAAO,OAAO,CAAC,QAAQ,KAAK,QAAQ,IAAI,OAAO,OAAO,CAAC,QAAQ,KAAK,QAAQ,CAAC,CAAC,CAAC;oBAC/E,EAAE,CAAC,SAAS,CAAC,sBAAsB,EAAE,sCAAsC,EAAE,kBAAkB,CAAC,CAAC;oBACjG,EAAE,CAAC,SAAS,CAAC,aAAa,EAAE,yBAAyB,EAAE,oCAAoC,CAAC,CAAC;oBAC7F,EAAE,CAAC,YAAY,CAAC,wBAAwB,EAAE,CAAC,OAAO,CAAC,QAAQ,EAAE,OAAO,CAAC,QAAQ,CAAC,CAAC,CAAC;oBAChF,WAAW,CAAC,GAAG,CAAC,KAAK,CAAC,sBAAsB,EAAE,CAAC,OAAO,CAAC,QAAQ,EAAE,OAAO,CAAC,QAAQ,CAAC,CAAC,CAAC;gBACxF,CAAC;gBAED,oCAAoC;gBACpC,EAAE,CAAC,CAAC,OAAO,CAAC,OAAO,IAAI,OAAO,OAAO,CAAC,OAAO,KAAK,QAAQ,CAAC,CAAC,CAAC;oBACzD,EAAE,CAAC,SAAS,CAAC,gBAAgB,EAAE,sBAAsB,EAAE,oCAAoC,CAAC,CAAC;oBAC7F,EAAE,CAAC,KAAK,CAAC,uBAAuB,EAAE,OAAO,CAAC,OAAO,CAAC,CAAC;oBACnD,WAAW,CAAC,GAAG,CAAC,KAAK,CAAC,yBAAyB,EAAE,OAAO,CAAC,OAAO,CAAC,CAAC;gBACtE,CAAC;gBAED,iCAAiC;gBACjC,EAAE,CAAC,CAAC,OAAO,CAAC,mBAAmB,IAAI,OAAO,OAAO,CAAC,mBAAmB,KAAK,QAAQ,CAAC,CAAC,CAAC;oBACjF,EAAE,CAAC,SAAS,CAAC,uBAAuB,EAAE,sBAAsB,EAAE,2CAA2C,CAAC,CAAC;oBAC3G,EAAE,CAAC,KAAK,CAAC,+BAA+B,EAAE,OAAO,CAAC,mBAAmB,CAAC,CAAC;oBACvE,WAAW,CAAC,GAAG,CAAC,KAAK,CAAC,oCAAoC,EAAE,OAAO,CAAC,mBAAmB,CAAC,CAAC;gBAC7F,CAAC;gBAED,EAAE,CAAC,CAAC,OAAO,CAAC,YAAY,CAAC,CAAC,CAAC;oBACvB,EAAE,CAAC,KAAK,CAAC,yBAAyB,EAAE,MAAM,EAAE,GAAG,GAAG,OAAO,CAAC,YAAY,GAAG,GAAG,CAAC,CAAC;gBAClF,CAAC;gBAED,EAAE,CAAC,CAAC,OAAO,CAAC,QAAQ,IAAI,CAAC,UAAU,CAAC,CAAC,CAAC;oBAClC,EAAE,CAAC,SAAS,CAAC,MAAM,EAAE,sBAAsB,EAAE,kBAAkB,CAAC,CAAC;gBACrE,CAAC;gBACD,EAAE,CAAC,OAAO,CAAC,kBAAkB,CAAC,CAAC;YAEnC,CAAC,CAAC;iBACD,OAAO,CAAC,YAAY,EAAE,OAAO,CAAC,KAAK,CAAC;iBACpC,KAAK,CAAC;gBACH,KAAK,EAAE,OAAO,CAAC,SAAS;gBACxB,MAAM,EAAE,OAAO,CAAC,IAAI,GAAG,OAAO,CAAC,SAAS;aAC3C,CAAC,CAAC;YAEP,EAAE,CAAC,CAAC,WAAW,CAAC,CAAC,CAAC;gBACd,MAAM,CAAC,MAAM,iBAAiB,CAAC,QAAQ,CAAC;oBACpC,WAAW,EAAE,IAAI,CAAC,SAAS;oBAC3B,cAAc;iBACjB,CAAC,CAAC;YACP,CAAC;YAAC,IAAI,CAAC,CAAC;gBACJ,MAAM,CAAC,MAAM,iBAAiB,CAAC,QAAQ,EAAE,CAAC;YAC9C,CAAC;QACL,CAAC;KAAA;IAGD,IAAW,SAAS,KAAa,MAAM,CAAC,eAAe,CAAC,CAAC,CAAC;IAC1D,IAAW,aAAa,KAAc,MAAM,CAAC,IAAI,CAAC,CAAC,CAAC;IAEpD,IAAW,EAAE,KAAa,MAAM,CAAC,IAAI,CAAC,GAAG,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC;IAClD,IAAW,EAAE,CAAC,KAAa,IAAI,IAAI,CAAC,GAAG,CAAC,IAAI,EAAE,KAAK,CAAC,CAAC,CAAC,CAAC;IAEvD,IAAW,IAAI,KAAa,MAAM,CAAC,IAAI,CAAC,GAAG,CAAC,MAAM,CAAC,CAAC,CAAC,CAAC;IACtD,IAAW,IAAI,CAAC,KAAa,IAAI,IAAI,CAAC,GAAG,CAAC,MAAM,EAAE,KAAK,CAAC,CAAC,CAAC,CAAC;IAE3D,IAAW,MAAM,KAAa,MAAM,CAAC,IAAI,CAAC,GAAG,CAAC,QAAQ,CAAC,CAAC,CAAC,CAAC;IAC1D,IAAW,MAAM,CAAC,KAAa,IAAI,IAAI,CAAC,GAAG,CAAC,QAAQ,EAAE,KAAK,CAAC,CAAC,CAAC,CAAC;IAE/D,IAAW,UAAU,KAAa,MAAM,CAAC,IAAI,CAAC,GAAG,CAAC,YAAY,CAAC,CAAC,CAAC,CAAC;IAClE,IAAW,UAAU,CAAC,KAAa,IAAI,IAAI,CAAC,GAAG,CAAC,YAAY,EAAE,KAAK,CAAC,CAAC,CAAC,CAAC;IAEvE,IAAW,QAAQ,KAAa,MAAM,CAAC,IAAI,CAAC,GAAG,CAAC,UAAU,CAAC,CAAC,CAAC,CAAC;IAC9D,IAAW,QAAQ,CAAC,KAAa,IAAI,IAAI,CAAC,GAAG,CAAC,UAAU,EAAE,KAAK,CAAC,CAAC,CAAC,CAAC;IAEnE,IAAW,SAAS,KAAa,MAAM,CAAC,IAAI,CAAC,GAAG,CAAC,WAAW,CAAC,CAAC,CAAC,CAAC;IAChE,IAAW,SAAS,CAAC,KAAa,IAAI,IAAI,CAAC,GAAG,CAAC,WAAW,EAAE,KAAK,CAAC,CAAC,CAAC,CAAC;IAErE,IAAW,UAAU,KAAa,MAAM,CAAC,IAAI,CAAC,GAAG,CAAC,YAAY,CAAC,CAAC,CAAC,CAAC;IAClE,IAAW,UAAU,CAAC,KAAa,IAAI,IAAI,CAAC,GAAG,CAAC,YAAY,EAAE,KAAK,CAAC,CAAC,CAAC,CAAC;IAEvE,IAAW,SAAS,KAAW,MAAM,CAAC,IAAI,CAAC,GAAG,CAAC,WAAW,CAAC,CAAC,CAAC,CAAC;IAC9D,IAAW,SAAS,CAAC,KAAW,IAAI,IAAI,CAAC,GAAG,CAAC,WAAW,EAAE,KAAK,CAAC,CAAC,CAAC,CAAC;IAEnE,IAAW,SAAS,KAAW,MAAM,CAAC,IAAI,CAAC,GAAG,CAAC,WAAW,CAAC,CAAC,CAAC,CAAC;IAC9D,IAAW,SAAS,CAAC,KAAW,IAAI,IAAI,CAAC,GAAG,CAAC,WAAW,EAAE,KAAK,CAAC,CAAC,CAAC,CAAC;IAE5D,eAAe;QAClB,MAAM,CAAC,IAAI,CAAC,MAAM,CAAC,iCAAe,CAAC,CAAC;IACxC,CAAC;IAEM,kBAAkB;QACrB,MAAM,CAAC,IAAI,CAAC,MAAM,CAAC,uCAAkB,CAAC,CAAC;IAC3C,CAAC;IAEM,oBAAoB;QACvB,MAAM,CAAC,IAAI,CAAC,OAAO,CAAC,2CAAoB,EAAE,iBAAiB,EAAE,IAAI,CAAC,CAAC;IACvE,CAAC;IAEM,kBAAkB;QACrB,MAAM,CAAC,IAAI,CAAC,OAAO,CAAC,qCAAiB,EAAE,iBAAiB,EAAE,IAAI,CAAC,CAAC;IACpE,CAAC;IAEM,aAAa;QAChB,MAAM,CAAC,IAAI,CAAC,OAAO,CAAC,2BAAY,EAAE,iBAAiB,EAAE,IAAI,CAAC,CAAC;IAC/D,CAAC;IAEM,mBAAmB;QACtB,MAAM,CAAC,IAAI,CAAC,SAAS,CAAC,yCAAmB,EAAE,0BAA0B,EAAE,IAAI,CAAC,CAAC;IACjF,CAAC;IAEM,QAAQ;QACX,MAAM,CAAC,IAAI,CAAC,SAAS,CAAC,mBAAQ,EAAE,aAAa,EAAE,IAAI,CAAC,CAAC;IACzD,CAAC;IAEM,IAAI;QACP,MAAM,CAAC,IAAI,CAAC,OAAO,CAAC,SAAG,EAAE,iBAAiB,EAAE,IAAI,CAAC,CAAC;IACtD,CAAC;IAEM,MAAM;QACT,MAAM,CAAC,IAAI,CAAC,SAAS,CAAC,eAAM,EAAE,WAAW,EAAE,IAAI,CAAC,CAAC;IACrD,CAAC;IAEM,WAAW;QACd,MAAM,CAAC,IAAI,CAAC,MAAM,CAAC,yBAAW,CAAC,CAAC;IACpC,CAAC;IAEM,gBAAgB;QACnB,MAAM,CAAC,IAAI,CAAC,OAAO,CAAC,mCAAgB,EAAE,iBAAiB,EAAE,IAAI,CAAC,CAAC;IACnE,CAAC;IAEM,cAAc;QACjB,MAAM,CAAC,IAAI,CAAC,OAAO,CAAC,6BAAa,EAAE,iBAAiB,EAAE,IAAI,CAAC,CAAC;IAChE,CAAC;;AA9Qa,eAAG,GAAe,IAAI,eAAU,CAAC,UAAU,CAAC,CAAC;AAE7C,qBAAS,GAAG;IACtB,iBAAiB;IACjB,8BAA8B;IAC9B,iDAAiD;IACjD,oEAAoE;IACpE,uFAAuF;IACvF,0GAA0G;IAC1G,8BAA8B;IAC9B,6CAA6C;IAC7C,4BAA4B;IAC5B,2CAA2C;IAC3C,sCAAsC;IACtC,oBAAoB;IACpB,2BAA2B;IAC3B,iCAAiC;IACjC,8BAA8B;IAC9B,4CAA4C;IAC5C,oDAAoD;IACpD,sBAAsB;IACtB,oBAAoB;IACpB,2CAA2C;IAC3C,gBAAgB;IAChB,+BAA+B;IAC/B,4BAA4B;IAC5B,8BAA8B;IAC9B,4BAA4B;IAC5B,MAAM;IACN,eAAe;IACf,gBAAgB;IAChB,sBAAsB;IACtB,QAAQ;IACR,aAAa;IACb,sBAAsB;IACtB,sCAAsC;IACtC,0CAA0C;IAC1C,qBAAqB;IACrB,6BAA6B;CAChC,CAAC;AAzCN,kCAiRC","sourcesContent":["// Copyright (c) 2017-2018, The Particl Market developers\n// Distributed under the GPL software license, see the accompanying\n// file COPYING or https://github.com/particl/particl-market/blob/develop/LICENSE\n\nimport { Bookshelf } from '../../config/Database';\nimport { Collection, Model } from 'bookshelf';\nimport { ItemInformation } from './ItemInformation';\nimport { PaymentInformation } from './PaymentInformation';\nimport { MessagingInformation } from './MessagingInformation';\nimport { ListingItemObject } from './ListingItemObject';\nimport { ListingItemSearchParams } from '../requests/ListingItemSearchParams';\nimport { FavoriteItem } from './FavoriteItem';\nimport { ListingItemTemplate } from './ListingItemTemplate';\nimport { Bid } from './Bid';\nimport { FlaggedItem } from './FlaggedItem';\nimport { Market } from './Market';\nimport { ShoppingCartItem } from './ShoppingCartItem';\nimport { ActionMessage } from './ActionMessage';\nimport { Proposal } from './Proposal';\nimport { Logger as LoggerType } from '../../core/Logger';\n\nexport class ListingItem extends Bookshelf.Model<ListingItem> {\n\n    public static log: LoggerType = new LoggerType(__filename);\n\n    public static RELATIONS = [\n        'ItemInformation',\n        'ItemInformation.ItemCategory',\n        'ItemInformation.ItemCategory.ParentItemCategory',\n        'ItemInformation.ItemCategory.ParentItemCategory.ParentItemCategory',\n        'ItemInformation.ItemCategory.ParentItemCategory.ParentItemCategory.ParentItemCategory',\n        'ItemInformation.ItemCategory.ParentItemCategory.ParentItemCategory.ParentItemCategory.ParentItemCategory',\n        'ItemInformation.ItemLocation',\n        'ItemInformation.ItemLocation.LocationMarker',\n        'ItemInformation.ItemImages',\n        'ItemInformation.ItemImages.ItemImageDatas',\n        'ItemInformation.ShippingDestinations',\n        'PaymentInformation',\n        'PaymentInformation.Escrow',\n        'PaymentInformation.Escrow.Ratio',\n        'PaymentInformation.ItemPrice',\n        'PaymentInformation.ItemPrice.ShippingPrice',\n        'PaymentInformation.ItemPrice.CryptocurrencyAddress',\n        'MessagingInformation',\n        'ListingItemObjects',\n        'ListingItemObjects.ListingItemObjectDatas',\n        'ActionMessages',\n        'ActionMessages.MessageObjects',\n        'ActionMessages.MessageInfo',\n        'ActionMessages.MessageEscrow',\n        'ActionMessages.MessageData',\n        'Bids',\n        'Bids.BidDatas',\n        'Bids.OrderItem',\n        'Bids.OrderItem.Order',\n        'Market',\n        'FlaggedItem',\n        'FlaggedItem.Proposal',\n        'FlaggedItem.Proposal.ProposalOptions',\n        // 'FlaggedItem.Proposal.ProposalResults',\n        'ListingItemTemplate',\n        'ListingItemTemplate.Profile'\n    ];\n\n    public static async fetchById(value: number, withRelated: boolean = true): Promise<ListingItem> {\n        if (withRelated) {\n            return await ListingItem.where<ListingItem>({ id: value }).fetch({\n                withRelated: this.RELATIONS\n            });\n        } else {\n            return await ListingItem.where<ListingItem>({ id: value }).fetch();\n        }\n    }\n\n    public static async fetchByHash(value: string, withRelated: boolean = true): Promise<ListingItem> {\n        if (withRelated) {\n            return await ListingItem.where<ListingItem>({ hash: value }).fetch({\n                withRelated: this.RELATIONS\n            });\n        } else {\n            return await ListingItem.where<ListingItem>({ hash: value }).fetch();\n        }\n    }\n\n    public static async fetchByCategory(categoryId: number, withRelated: boolean = true): Promise<Collection<ListingItem>> {\n\n        const listingCollection = ListingItem.forge<Model<ListingItem>>()\n            .query(qb => {\n                qb.innerJoin('item_informations', 'listing_items.id', 'item_informations.listing_item_id');\n                qb.where('item_informations.item_category_id', '=', categoryId);\n                // ignore expired items\n                qb.andWhere('expired_at', '>', Date.now());\n                qb.andWhere('item_informations.item_category_id', '>', 0);\n            })\n            .orderBy('item_informations.title', 'ASC');\n\n        if (withRelated) {\n            return await listingCollection.fetchAll({\n                withRelated: this.RELATIONS\n            });\n        } else {\n            return await listingCollection.fetchAll();\n        }\n    }\n\n    public static async fetchExpired(): Promise<Collection<ListingItem>> {\n        const listingCollection = ListingItem.forge<Model<ListingItem>>()\n            .query(qb => {\n                qb.where('expired_at', '<=', Date.now());\n                qb.groupBy('listing_items.id');\n            });\n        return await listingCollection.fetchAll();\n    }\n\n    public static async searchBy(options: ListingItemSearchParams, withRelated: boolean = false): Promise<Collection<ListingItem>> {\n\n        const listingCollection = ListingItem.forge<Model<ListingItem>>()\n            .query(qb => {\n                // ignore expired items\n                qb.where('expired_at', '>', Date.now());\n\n                // search by itemHash\n                if (options.itemHash && typeof options.itemHash === 'string' && options.itemHash !== '*') {\n                    qb.innerJoin('listing_item_templates', 'listing_item_templates.id', 'listing_items.listing_item_template_id');\n                    qb.where('listing_item_templates.hash', '=', options.itemHash);\n\n                    ListingItem.log.debug('...search by itemHash: ', options.itemHash);\n                }\n\n                // search by buyer\n                let joinedBids = false;\n                if (options.buyer && typeof options.buyer === 'string' && options.buyer !== '*') {\n                    if (!joinedBids) {\n                        qb.innerJoin('bids', 'bids.listing_item_id', 'listing_items.id');\n                        joinedBids = true;\n                    }\n                    qb.where('bids.bidder', '=', options.buyer);\n                    ListingItem.log.debug('...search by buyer: ', options.buyer);\n                }\n\n                // search by seller\n                if (options.seller && typeof options.seller === 'string' && options.seller !== '*') {\n                    qb.where('listing_items.seller', '=', options.seller);\n                    ListingItem.log.debug('...search by seller: ', options.seller);\n                }\n\n                qb.innerJoin('item_informations', 'item_informations.listing_item_id', 'listing_items.id');\n\n                if (options.category && typeof options.category === 'number') {\n                    qb.innerJoin('item_categories', 'item_categories.id', 'item_informations.item_category_id');\n                    qb.where('item_categories.id', '=', options.category);\n                    ListingItem.log.debug('...search by category.id: ', options.category);\n                } else if (options.category && typeof options.category === 'string') {\n                    qb.innerJoin('item_categories', 'item_categories.id', 'item_informations.item_category_id');\n                    qb.where('item_categories.key', '=', options.category);\n                    ListingItem.log.debug('...search by category.key: ', options.category);\n                }\n\n                // search by profile\n                if (typeof options.profileId === 'number') {\n                    qb.innerJoin('listing_item_templates', 'listing_item_templates.id', 'listing_items.listing_item_template_id');\n                    qb.where('listing_item_templates.profile_id', '=', options.profileId);\n                    ListingItem.log.debug('...search by profileId: ', options.profileId);\n\n                } else if (options.profileId === 'OWN') { // ListingItems belonging to any profile\n                    qb.innerJoin('listing_item_templates', 'listing_item_templates.id', 'listing_items.listing_item_template_id');\n                }\n\n                // search by item price\n                if (typeof options.minPrice === 'number' && typeof options.maxPrice === 'number') {\n                    qb.innerJoin('payment_informations', 'payment_informations.listing_item_id', 'listing_items.id');\n                    qb.innerJoin('item_prices', 'payment_informations.id', 'item_prices.payment_information_id');\n                    qb.whereBetween('item_prices.base_price', [options.minPrice, options.maxPrice]);\n                    ListingItem.log.debug('...search by price: ', [options.minPrice, options.maxPrice]);\n                }\n\n                // search by item location (country)\n                if (options.country && typeof options.country === 'string') {\n                    qb.innerJoin('item_locations', 'item_informations.id', 'item_locations.item_information_id');\n                    qb.where('item_locations.region', options.country);\n                    ListingItem.log.debug('...search by location: ', options.country);\n                }\n\n                // search by shipping destination\n                if (options.shippingDestination && typeof options.shippingDestination === 'string') {\n                    qb.innerJoin('shipping_destinations', 'item_informations.id', 'shipping_destinations.item_information_id');\n                    qb.where('shipping_destinations.country', options.shippingDestination);\n                    ListingItem.log.debug('...search by shippingDestination: ', options.shippingDestination);\n                }\n\n                if (options.searchString) {\n                    qb.where('item_informations.title', 'LIKE', '%' + options.searchString + '%');\n                }\n\n                if (options.withBids && !joinedBids) { // Don't want to join twice or we'll get errors.\n                    qb.innerJoin('bids', 'bids.listing_item_id', 'listing_items.id');\n                }\n                qb.groupBy('listing_items.id');\n\n            })\n            .orderBy('updated_at', options.order)\n            .query({\n                limit: options.pageLimit,\n                offset: options.page * options.pageLimit\n            });\n\n        if (withRelated) {\n            return await listingCollection.fetchAll({\n                withRelated: this.RELATIONS\n                // debug: true\n            });\n        } else {\n            return await listingCollection.fetchAll();\n        }\n    }\n\n\n    public get tableName(): string { return 'listing_items'; }\n    public get hasTimestamps(): boolean { return true; }\n\n    public get Id(): number { return this.get('id'); }\n    public set Id(value: number) { this.set('id', value); }\n\n    public get Hash(): string { return this.get('hash'); }\n    public set Hash(value: string) { this.set('hash', value); }\n\n    public get Seller(): string { return this.get('seller'); }\n    public set Seller(value: string) { this.set('seller', value); }\n\n    public get ExpiryTime(): number { return this.get('expiryTime'); }\n    public set ExpiryTime(value: number) { this.set('expiryTime', value); }\n\n    public get PostedAt(): number { return this.get('postedAt'); }\n    public set PostedAt(value: number) { this.set('postedAt', value); }\n\n    public get ExpiredAt(): number { return this.get('expiredAt'); }\n    public set ExpiredAt(value: number) { this.set('expiredAt', value); }\n\n    public get ReceivedAt(): number { return this.get('receivedAt'); }\n    public set ReceivedAt(value: number) { this.set('receivedAt', value); }\n\n    public get UpdatedAt(): Date { return this.get('updatedAt'); }\n    public set UpdatedAt(value: Date) { this.set('updatedAt', value); }\n\n    public get CreatedAt(): Date { return this.get('createdAt'); }\n    public set CreatedAt(value: Date) { this.set('createdAt', value); }\n\n    public ItemInformation(): ItemInformation {\n        return this.hasOne(ItemInformation);\n    }\n\n    public PaymentInformation(): PaymentInformation {\n        return this.hasOne(PaymentInformation);\n    }\n\n    public MessagingInformation(): Collection<MessagingInformation> {\n        return this.hasMany(MessagingInformation, 'listing_item_id', 'id');\n    }\n\n    public ListingItemObjects(): Collection<ListingItemObject> {\n        return this.hasMany(ListingItemObject, 'listing_item_id', 'id');\n    }\n\n    public FavoriteItems(): Collection<FavoriteItem> {\n        return this.hasMany(FavoriteItem, 'listing_item_id', 'id');\n    }\n\n    public ListingItemTemplate(): ListingItemTemplate {\n        return this.belongsTo(ListingItemTemplate, 'listing_item_template_id', 'id');\n    }\n\n    public Proposal(): Proposal {\n        return this.belongsTo(Proposal, 'proposal_id', 'id');\n    }\n\n    public Bids(): Collection<Bid> {\n        return this.hasMany(Bid, 'listing_item_id', 'id');\n    }\n\n    public Market(): Market {\n        return this.belongsTo(Market, 'market_id', 'id');\n    }\n\n    public FlaggedItem(): FlaggedItem {\n        return this.hasOne(FlaggedItem);\n    }\n\n    public ShoppingCartItem(): Collection<ShoppingCartItem> {\n        return this.hasMany(ShoppingCartItem, 'listing_item_id', 'id');\n    }\n\n    public ActionMessages(): Collection<ActionMessage> {\n        return this.hasMany(ActionMessage, 'listing_item_id', 'id');\n    }\n}\n"]}