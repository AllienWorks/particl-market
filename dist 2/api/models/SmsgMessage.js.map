{"version":3,"file":"SmsgMessage.js","sourceRoot":"","sources":["../../../src/api/models/SmsgMessage.ts"],"names":[],"mappings":"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","sourcesContent":["// Copyright (c) 2017-2018, The Particl Market developers\n// Distributed under the GPL software license, see the accompanying\n// file COPYING or https://github.com/particl/particl-market/blob/develop/LICENSE\n\nimport { Bookshelf } from '../../config/Database';\nimport { Collection, Model } from 'bookshelf';\nimport { SmsgMessageSearchParams } from '../requests/SmsgMessageSearchParams';\nimport * as _ from 'lodash';\n\nexport class SmsgMessage extends Bookshelf.Model<SmsgMessage> {\n\n    public static RELATIONS = [];\n\n    public static async searchBy(options: SmsgMessageSearchParams, withRelated: boolean = false): Promise<Collection<SmsgMessage>> {\n\n        options.page = options.page || 0;\n        options.pageLimit = options.pageLimit || 10;\n\n        const messageCollection = SmsgMessage.forge<Model<SmsgMessage>>()\n            .query(qb => {\n\n                if (!_.isEmpty(options.msgid)) {\n                    qb.where('smsg_messages.msgid', '=', options.msgid);\n                }\n\n                if (!_.isEmpty(options.status)) {\n                    qb.where('smsg_messages.status', '=', options.status.toString());\n                }\n\n                if (!_.isEmpty(options.types)) {\n                    qb.whereIn('smsg_messages.type', options.types);\n                }\n\n                qb.where('smsg_messages.created_at', '<', Date.now() - options.age);\n\n            })\n            .orderBy(options.orderByColumn, options.order)\n            .query({\n                limit: options.pageLimit,\n                offset: options.page * options.pageLimit\n            });\n\n        if (withRelated) {\n            return await messageCollection.fetchAll({\n                withRelated: this.RELATIONS\n            });\n        } else {\n            return await messageCollection.fetchAll();\n        }\n    }\n\n    public static async fetchById(value: number, withRelated: boolean = true): Promise<SmsgMessage> {\n        if (withRelated) {\n            return await SmsgMessage.where<SmsgMessage>({ id: value }).fetch({\n                withRelated: this.RELATIONS\n            });\n        } else {\n            return await SmsgMessage.where<SmsgMessage>({ id: value }).fetch();\n        }\n    }\n\n    public static async fetchByMsgId(value: string, withRelated: boolean = true): Promise<SmsgMessage> {\n        if (withRelated) {\n            return await SmsgMessage.where<SmsgMessage>({ msgid: value }).fetch({\n                withRelated: this.RELATIONS\n            });\n        } else {\n            return await SmsgMessage.where<SmsgMessage>({ msgid: value }).fetch();\n        }\n    }\n\n    public get tableName(): string { return 'smsg_messages'; }\n    public get hasTimestamps(): boolean { return true; }\n\n    public get Id(): number { return this.get('id'); }\n    public set Id(value: number) { this.set('id', value); }\n\n    public get Type(): string { return this.get('type'); }\n    public set Type(value: string) { this.set('type', value); }\n\n    public get Status(): string { return this.get('status'); }\n    public set Status(value: string) { this.set('status', value); }\n\n    public get Msgid(): string { return this.get('msgid'); }\n    public set Msgid(value: string) { this.set('msgid', value); }\n\n    public get Version(): string { return this.get('version'); }\n    public set Version(value: string) { this.set('version', value); }\n\n    public get Read(): boolean { return this.get('read'); }\n    public set Read(value: boolean) { this.set('read', value); }\n\n    public get Paid(): boolean { return this.get('paid'); }\n    public set Paid(value: boolean) { this.set('paid', value); }\n\n    public get Payloadsize(): number { return this.get('payloadsize'); }\n    public set Payloadsize(value: number) { this.set('payloadsize', value); }\n\n    public get Received(): number { return this.get('received'); }\n    public set Received(value: number) { this.set('received', value); }\n\n    public get Sent(): number { return this.get('sent'); }\n    public set Sent(value: number) { this.set('sent', value); }\n\n    public get Expiration(): number { return this.get('expiration'); }\n    public set Expiration(value: number) { this.set('expiration', value); }\n\n    public get Daysretention(): number { return this.get('daysretention'); }\n    public set Daysretention(value: number) { this.set('daysretention', value); }\n\n    public get From(): string { return this.get('from'); }\n    public set From(value: string) { this.set('from', value); }\n\n    public get To(): string { return this.get('to'); }\n    public set To(value: string) { this.set('to', value); }\n\n    public get Text(): string { return this.get('text'); }\n    public set Text(value: string) { this.set('text', value); }\n\n    public get UpdatedAt(): Date { return this.get('updatedAt'); }\n    public set UpdatedAt(value: Date) { this.set('updatedAt', value); }\n\n    public get CreatedAt(): Date { return this.get('createdAt'); }\n    public set CreatedAt(value: Date) { this.set('createdAt', value); }\n\n}\n"]}